<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<iron-iconset-svg size="24" name="previewplayer">
<svg><defs>
<g id="pause"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></g>
<g id="play"><path d="M8 5v14l11-7z"></path></g>
</defs></svg>
</iron-iconset-svg>

<dom-module id="sp-preview-player">
  <template>
    <style>
    
      :host {
        display: block;
        height: 40px;
        width: 40px;
        padding: 0 !important;
      }
      
      paper-icon-button {
        color: inherit;
        opacity: inherit;
        padding: var(--preview-player-padding, 8px);
        height: 100%;
        width: 100%;
      }
      
    </style>
    
    <paper-icon-button icon="previewplayer:[[_computeIcon(_playing)]]" on-tap="_togglePlay"></paper-icon-button>
    
    <audio id="player" loop src="[[_getSong(song)]]"></audio>
  </template>

  <script>
    class PreviewPlayer extends Polymer.Element {
      
      static get is() { return 'sp-preview-player'; }
      
      static get properties() { return {
        
        song: String,
        
        _playing: {
          type: Boolean,
          value: false
        }
        
      } }
      
      constructor() {
        super();
      }
      
      _computeIcon(playing) {
        return playing ? 'pause' : 'play';
      }
      
      _getSong(song) {
        return window.appState.audio[song];
      }
      
      _togglePlay(e) {
        e.stopPropagation();
        const player = this.$.player;
        if (this._playing) {
          this._playStatus.then(() => {
            player.pause();
            this._playing = false;
          });
        } else {
          this._playStatus = player.play();
          this._playing = true;
        }
      }
      
    }

    customElements.define(PreviewPlayer.is, PreviewPlayer);
  </script>
</dom-module>
