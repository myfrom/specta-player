<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="sharedicons.html">

<dom-module id="sp-preview-player">
  <template>
    <style>
    
      :host {
        display: inline-block;
      }
      
      paper-icon-button {
        border-radius: 50%;
        color: black;
        opacity: 0.87;
        padding: 5px;
        height: 28px;
        width: 28px;
      }
      
    </style>
    
    <paper-icon-button icon="sharedicons:[[_computeIcon(_playing)]]" on-tap="_togglePlay"></paper-icon-button>
    
    <audio id="player" loop src="[[_getSong(song)]]"></audio>
  </template>

  <script>
    class PreviewPlayer extends Polymer.Element {
      
      static get is() { return 'sp-preview-player'; }
      
      static get properties() { return {
        
        song: String,
        
        _playing: {
          type: Boolean,
          value: false
        }
        
      } }
      
      constructor() {
        super();
      }
      
      _computeIcon(playing) {
        return playing ? 'pause' : 'play';
      }
      
      _getSong(song) {
        return window._audio[song];
      }
      
      _togglePlay() {
        const player = this.$.player;
        if (this._playing) {
          this._playStatus.then(() => {
            player.pause();
            this._playing = false;
          });
        } else {
          this._playStatus = player.play();
          this._playing = true;
        }
      }
      
    }

    customElements.define(PreviewPlayer.is, PreviewPlayer);
  </script>
</dom-module>
